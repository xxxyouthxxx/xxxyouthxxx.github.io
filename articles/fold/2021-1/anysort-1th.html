<!DOCTYPE html>
<html lang="zh-cmn-Hans">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>🌐 Anysort：灵活、优雅、无依赖的排序库 | YoochBlog</title>
    <meta name="generator" content="VuePress 1.9.8">
    <link rel="dns-prefetch" href="/utteranc.es">
    <link rel="shortcut icon" href="/favicon.ico">
    <script src="//instant.page/5.1.0" type="module" integrity="sha384-by67kQnR+pyfy8yWP4kPO12fHKRLHZPfEsiSXR8u2IKcTdxD805MGUXBzVPnkLHw" defer="defer"></script>
    <script src="//js.fundebug.cn/fundebug.2.5.0.min.js" crossorigin="anonymous" apikey="6cf8608d1691cea338ccf8b2057530f1991968b20555ea79ff3cb6261e6cba77" defer="defer"></script>
    <script defer="defer">
            var _hmt = _hmt || [];
            (function() {
                var hm = document.createElement("script");
                hm.src = "https://hm.baidu.com/hm.js?9f386eab0658c409277cb8e60691de6e";
                var s = document.getElementsByTagName("script")[0]; 
                s.parentNode.insertBefore(hm, s);
            })();
        </script>
    <script defer="defer" crossorigin="crossorigin">
            window.__bl = {
                config: {
                    pid:"eeh52p97ae@20a026fed78311e",
                    appType:"web",
                    imgUrl:"https://arms-retcode.aliyuncs.com/r.png?",
                    sendResource:true,
                    enableLinkTrace:true,
                    behavior:true,
                    enableConsole:true,
                    useFmp:true
                }
            }
            ;(function() {
                var hm = document.createElement("script");
                hm.src = "https://retcode.alicdn.com/retcode/bl.js";
                var s = document.getElementsByTagName("script")[0]; 
                s.parentNode.insertBefore(hm, s);
            })()
        </script>
    <meta name="description" content="网易云音乐的歌单排序功能比较弱，本文介绍了使用函数式JS代码搭建一个自定义排序库的思路，以支持对歌单进行任意排序。">
    <meta name="keywords" content="JavaScript,函数式,排序库,歌单排序,网易云歌单排序,自定义排序,网易云音乐接口,anysort">
    <meta name="baidu-site-verification" content="Mdz47FJiHx">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <link rel="preload" href="/assets/css/0.styles.68e428c0.css" as="style"><link rel="preload" href="/assets/js/app.dacd158f.js" as="script"><link rel="preload" href="/assets/js/layout-Layout.a690710d.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Layout.fb1af457.js" as="script"><link rel="preload" href="/assets/js/linghuoyouyawuyilaidepaixuku.ce1a192e.js" as="script"><link rel="prefetch" href="/assets/js/128.14e69869.js"><link rel="prefetch" href="/assets/js/129.1a612441.js"><link rel="prefetch" href="/assets/js/130.5d292bef.js"><link rel="prefetch" href="/assets/js/131.a2fea7db.js"><link rel="prefetch" href="/assets/js/132.9fac5b08.js"><link rel="prefetch" href="/assets/js/133.c60d2529.js"><link rel="prefetch" href="/assets/js/134.64097e6a.js"><link rel="prefetch" href="/assets/js/135.de69bd66.js"><link rel="prefetch" href="/assets/js/136.a0f1b19f.js"><link rel="prefetch" href="/assets/js/137.4f5ca37a.js"><link rel="prefetch" href="/assets/js/138.65973f98.js"><link rel="prefetch" href="/assets/js/139.f48d9fac.js"><link rel="prefetch" href="/assets/js/140.89d08fb7.js"><link rel="prefetch" href="/assets/js/141.d9c4ac40.js"><link rel="prefetch" href="/assets/js/142.cdf63f1a.js"><link rel="prefetch" href="/assets/js/143.ad8bd569.js"><link rel="prefetch" href="/assets/js/144.c3703271.js"><link rel="prefetch" href="/assets/js/145.df209d87.js"><link rel="prefetch" href="/assets/js/146.9f48b5fb.js"><link rel="prefetch" href="/assets/js/147.9d8e5ea9.js"><link rel="prefetch" href="/assets/js/148.92d33d69.js"><link rel="prefetch" href="/assets/js/149.7334998b.js"><link rel="prefetch" href="/assets/js/150.a39314f5.js"><link rel="prefetch" href="/assets/js/151.3547abfe.js"><link rel="prefetch" href="/assets/js/152.75490790.js"><link rel="prefetch" href="/assets/js/153.32961986.js"><link rel="prefetch" href="/assets/js/154.2b1b2406.js"><link rel="prefetch" href="/assets/js/155.443249cc.js"><link rel="prefetch" href="/assets/js/156.ccdca739.js"><link rel="prefetch" href="/assets/js/157.bc78369c.js"><link rel="prefetch" href="/assets/js/158.fa2a0fea.js"><link rel="prefetch" href="/assets/js/159.f6974d2e.js"><link rel="prefetch" href="/assets/js/160.21aae9c2.js"><link rel="prefetch" href="/assets/js/161.874663ef.js"><link rel="prefetch" href="/assets/js/162.88cbf6a4.js"><link rel="prefetch" href="/assets/js/163.b7f3f94b.js"><link rel="prefetch" href="/assets/js/164.4184e453.js"><link rel="prefetch" href="/assets/js/165.abc9036b.js"><link rel="prefetch" href="/assets/js/166.1b6c63b1.js"><link rel="prefetch" href="/assets/js/167.1afd5ad4.js"><link rel="prefetch" href="/assets/js/168.62ed4043.js"><link rel="prefetch" href="/assets/js/169.d3af4343.js"><link rel="prefetch" href="/assets/js/170.83aa52ec.js"><link rel="prefetch" href="/assets/js/171.c1cdb803.js"><link rel="prefetch" href="/assets/js/172.cca7cc98.js"><link rel="prefetch" href="/assets/js/173.7a963e01.js"><link rel="prefetch" href="/assets/js/174.0fa3de14.js"><link rel="prefetch" href="/assets/js/175.b86d0c48.js"><link rel="prefetch" href="/assets/js/176.de1abb03.js"><link rel="prefetch" href="/assets/js/177.ed588eb6.js"><link rel="prefetch" href="/assets/js/178.6209ff51.js"><link rel="prefetch" href="/assets/js/179.8f890918.js"><link rel="prefetch" href="/assets/js/180.b61430ac.js"><link rel="prefetch" href="/assets/js/181.658647ad.js"><link rel="prefetch" href="/assets/js/182.4877f2ce.js"><link rel="prefetch" href="/assets/js/183.4d29cf19.js"><link rel="prefetch" href="/assets/js/184.61848361.js"><link rel="prefetch" href="/assets/js/185.435db16c.js"><link rel="prefetch" href="/assets/js/186.8dbd1f31.js"><link rel="prefetch" href="/assets/js/187.ce0835f7.js"><link rel="prefetch" href="/assets/js/188.567cb6ab.js"><link rel="prefetch" href="/assets/js/188aa0d0.28c68ff4.js"><link rel="prefetch" href="/assets/js/189.c0489fa4.js"><link rel="prefetch" href="/assets/js/190.87366fac.js"><link rel="prefetch" href="/assets/js/191.334e0179.js"><link rel="prefetch" href="/assets/js/192.b8e03f6a.js"><link rel="prefetch" href="/assets/js/193.55a3491d.js"><link rel="prefetch" href="/assets/js/194.b9b83cb4.js"><link rel="prefetch" href="/assets/js/195.4ffd47b9.js"><link rel="prefetch" href="/assets/js/196.898adb5a.js"><link rel="prefetch" href="/assets/js/197.b2e86c09.js"><link rel="prefetch" href="/assets/js/198.1d8fccd5.js"><link rel="prefetch" href="/assets/js/199.edb243e8.js"><link rel="prefetch" href="/assets/js/200.c1397018.js"><link rel="prefetch" href="/assets/js/201.9fd7f6bb.js"><link rel="prefetch" href="/assets/js/202.ce30cc72.js"><link rel="prefetch" href="/assets/js/202344.7fd5a992.js"><link rel="prefetch" href="/assets/js/203.a6cc52d9.js"><link rel="prefetch" href="/assets/js/204.a1ff59aa.js"><link rel="prefetch" href="/assets/js/205.d21ef5ad.js"><link rel="prefetch" href="/assets/js/206.5c80f5c8.js"><link rel="prefetch" href="/assets/js/207.09f3108c.js"><link rel="prefetch" href="/assets/js/208.00110bb9.js"><link rel="prefetch" href="/assets/js/209.4d289b4b.js"><link rel="prefetch" href="/assets/js/210.fb6cff5d.js"><link rel="prefetch" href="/assets/js/211.74d4174c.js"><link rel="prefetch" href="/assets/js/212.33af8f09.js"><link rel="prefetch" href="/assets/js/213.eda854d9.js"><link rel="prefetch" href="/assets/js/214.ec8e8b02.js"><link rel="prefetch" href="/assets/js/215.9bbf60ca.js"><link rel="prefetch" href="/assets/js/216.13dd6e6a.js"><link rel="prefetch" href="/assets/js/217.cd659ae8.js"><link rel="prefetch" href="/assets/js/218.2090dc69.js"><link rel="prefetch" href="/assets/js/219.816ce836.js"><link rel="prefetch" href="/assets/js/220.e5447b48.js"><link rel="prefetch" href="/assets/js/221.ccacfd12.js"><link rel="prefetch" href="/assets/js/222.49d7c938.js"><link rel="prefetch" href="/assets/js/223.269f23d1.js"><link rel="prefetch" href="/assets/js/224.502262fa.js"><link rel="prefetch" href="/assets/js/225.66e99592.js"><link rel="prefetch" href="/assets/js/226.3e211165.js"><link rel="prefetch" href="/assets/js/227.dc8cdb75.js"><link rel="prefetch" href="/assets/js/228.b66479ab.js"><link rel="prefetch" href="/assets/js/229.8aea98c6.js"><link rel="prefetch" href="/assets/js/230.275f4523.js"><link rel="prefetch" href="/assets/js/231.9c450e06.js"><link rel="prefetch" href="/assets/js/33cd14d0.1870c07a.js"><link rel="prefetch" href="/assets/js/Angular.e5a0840d.js"><link rel="prefetch" href="/assets/js/CSSColorModule.90bbac9c.js"><link rel="prefetch" href="/assets/js/CSSConditionalRulesModule.cfedcaab.js"><link rel="prefetch" href="/assets/js/CSSMindMap.7af0e763.js"><link rel="prefetch" href="/assets/js/CSSScrollbarsStylingModule.ab43f69c.js"><link rel="prefetch" href="/assets/js/CanvasBlocker.28887fdc.js"><link rel="prefetch" href="/assets/js/CloudNative.00c393fd.js"><link rel="prefetch" href="/assets/js/Compiler.5ee42cbd.js"><link rel="prefetch" href="/assets/js/ComputerMindMap.4ba4f5b9.js"><link rel="prefetch" href="/assets/js/DevOpsMindMap.b84593e9.js"><link rel="prefetch" href="/assets/js/Docker.5ff3de47.js"><link rel="prefetch" href="/assets/js/ElementUIElementPlus.369488ba.js"><link rel="prefetch" href="/assets/js/Eviljs.2e1bf83b.js"><link rel="prefetch" href="/assets/js/GitLab.b077a34e.js"><link rel="prefetch" href="/assets/js/GitMindMap.690db46c.js"><link rel="prefetch" href="/assets/js/Gitflow.e370b9eb.js"><link rel="prefetch" href="/assets/js/HTMLExtends.7a0dc665.js"><link rel="prefetch" href="/assets/js/HTMLMindMap.fa563575.js"><link rel="prefetch" href="/assets/js/ITCSSInvertedTriangleCSS.43675008.js"><link rel="prefetch" href="/assets/js/JavaScriptMicroTemplating.c17648de.js"><link rel="prefetch" href="/assets/js/JavaScriptMindMap.91c312e6.js"><link rel="prefetch" href="/assets/js/KingDB.04351f7d.js"><link rel="prefetch" href="/assets/js/Linter.cc80c036.js"><link rel="prefetch" href="/assets/js/Linux.447bbf65.js"><link rel="prefetch" href="/assets/js/Lodashtemplate.c61c4968.js"><link rel="prefetch" href="/assets/js/Monorepo.6593f1de.js"><link rel="prefetch" href="/assets/js/NPM.1df608d2.js"><link rel="prefetch" href="/assets/js/NginxConfigExample.d3990a61.js"><link rel="prefetch" href="/assets/js/NodeJS.9a888fad.js"><link rel="prefetch" href="/assets/js/NodeJSRequire.cc564343.js"><link rel="prefetch" href="/assets/js/Objectassign.2649c0c3.js"><link rel="prefetch" href="/assets/js/PNPMPerformantnpm.6d273ffc.js"><link rel="prefetch" href="/assets/js/Promise.350fd83d.js"><link rel="prefetch" href="/assets/js/ReactMindMap.a2b44c2a.js"><link rel="prefetch" href="/assets/js/ScopedCSS.c481782b.js"><link rel="prefetch" href="/assets/js/SecurityMindMap.51c60576.js"><link rel="prefetch" href="/assets/js/Serverless.da609f3a.js"><link rel="prefetch" href="/assets/js/SubresourceIntegrity.fbedefda.js"><link rel="prefetch" href="/assets/js/TypeScript.7bb165af.js"><link rel="prefetch" href="/assets/js/TypeScriptTypeChanllenges.af95fd05.js"><link rel="prefetch" href="/assets/js/UtilityTypes.8d013e60.js"><link rel="prefetch" href="/assets/js/VersionControl.71d54e96.js"><link rel="prefetch" href="/assets/js/VueJSObserver.13817188.js"><link rel="prefetch" href="/assets/js/VueJSParser.4e5296b8.js"><link rel="prefetch" href="/assets/js/VueMindMap.f8265b4f.js"><link rel="prefetch" href="/assets/js/VueTestUtils.fbc1e853.js"><link rel="prefetch" href="/assets/js/a5d1c9ac.a357a1a4.js"><link rel="prefetch" href="/assets/js/b7d9e848.554e0ecd.js"><link rel="prefetch" href="/assets/js/banmananti.37e5b6ce.js"><link rel="prefetch" href="/assets/js/baoguanliqi.c07e04cc.js"><link rel="prefetch" href="/assets/js/bixujixialai.df65a36c.js"><link rel="prefetch" href="/assets/js/changyongleixingpanduanfangfadeyoushijiquexian.15ea8681.js"><link rel="prefetch" href="/assets/js/chengyunxiaochengxu.9e24e852.js"><link rel="prefetch" href="/assets/js/chengyunxinlingshou.f2313a29.js"><link rel="prefetch" href="/assets/js/congyifufengjinghuazhongxuexigehuituzhishidian.4a97d4c3.js"><link rel="prefetch" href="/assets/js/congyigeyuexieyuemandebianjiqizhongliaoliaoyouhuasilu.9072be75.js"><link rel="prefetch" href="/assets/js/cuowubianjiezujian.d6fd51e9.js"><link rel="prefetch" href="/assets/js/dabaogongju.8fc4bb45.js"><link rel="prefetch" href="/assets/js/deindent.2d2bbafe.js"><link rel="prefetch" href="/assets/js/dibanbenliulanqijianrongbiaoqianyuanli.751b55e7.js"><link rel="prefetch" href="/assets/js/dima.66e54876.js"><link rel="prefetch" href="/assets/js/ganxingqudewenti.a8a342e3.js"><link rel="prefetch" href="/assets/js/gengxinrizhi.2c2c845a.js"><link rel="prefetch" href="/assets/js/gongjuhanshuwuchongtuchuli.e1ff97d4.js"><link rel="prefetch" href="/assets/js/guanyubiaodiandeneixieshier.1c9ba85a.js"><link rel="prefetch" href="/assets/js/guifanjihe.6fb1224b.js"><link rel="prefetch" href="/assets/js/jishujianli.6ae2bacf.js"><link rel="prefetch" href="/assets/js/jisuanjiwangluo.bc344f78.js"><link rel="prefetch" href="/assets/js/jiushixiwangxiangsu.dc79114f.js"><link rel="prefetch" href="/assets/js/kuheyuanma.e67c7103.js"><link rel="prefetch" href="/assets/js/layout-NotFound.af816131.js"><link rel="prefetch" href="/assets/js/leixingticao.795a63d9.js"><link rel="prefetch" href="/assets/js/liaoliaocicilizhibiyejiqitazaluandeshiqing.d60ced8d.js"><link rel="prefetch" href="/assets/js/liulanqi.53e7507f.js"><link rel="prefetch" href="/assets/js/liulanqixiangguan.c7b80c8f.js"><link rel="prefetch" href="/assets/js/luyoujishu.e9f27357.js"><link rel="prefetch" href="/assets/js/lvmaoshuiguai.0ca6173d.js"><link rel="prefetch" href="/assets/js/mianshifupan.889e1a5f.js"><link rel="prefetch" href="/assets/js/mianshititiku.cba02359.js"><link rel="prefetch" href="/assets/js/mokuaihuajianshi.3e82445c.js"><link rel="prefetch" href="/assets/js/nodewatch.92cf87a8.js"><link rel="prefetch" href="/assets/js/pachongyufanpachong.fe37b781.js"><link rel="prefetch" href="/assets/js/panduanlianggebianliangxiangdeng.cf8dcaf2.js"><link rel="prefetch" href="/assets/js/panduanshifouzaixian.90b5663e.js"><link rel="prefetch" href="/assets/js/qiantaoliebiaobujudexiefa.944bdb10.js"><link rel="prefetch" href="/assets/js/qinmiguanxi.68293a9c.js"><link rel="prefetch" href="/assets/js/quanju.51608a86.js"><link rel="prefetch" href="/assets/js/quanlidouzhengzhongdewudaoyujiashe.55a0af45.js"><link rel="prefetch" href="/assets/js/riji.0586813e.js"><link rel="prefetch" href="/assets/js/shanghupingtai.66fa2c49.js"><link rel="prefetch" href="/assets/js/shenmeshixinliu.747d8593.js"><link rel="prefetch" href="/assets/js/shenmizhuyideyishu.15c0bf08.js"><link rel="prefetch" href="/assets/js/shibasuichumenyuanxing.1af7346b.js"><link rel="prefetch" href="/assets/js/shijiejiushiyigecaotaibanzi.151f897e.js"><link rel="prefetch" href="/assets/js/shujudapan.ff70d86e.js"><link rel="prefetch" href="/assets/js/suanfa.864cbfaa.js"><link rel="prefetch" href="/assets/js/tingshuonihaizaishouxielanjiazai.bf23d4a6.js"><link rel="prefetch" href="/assets/js/webpack.11b618f0.js"><link rel="prefetch" href="/assets/js/weiqianduan.5187ab7b.js"><link rel="prefetch" href="/assets/js/weishimewoyaoxieboke.80ab2a74.js"><link rel="prefetch" href="/assets/js/weishimezhiyouwozhexiayu.d52ab8db.js"><link rel="prefetch" href="/assets/js/wenziyuqingxu.17f9b6cd.js"><link rel="prefetch" href="/assets/js/woxiangyaozaiduyidian.27d70dc0.js"><link rel="prefetch" href="/assets/js/wuti.0270f557.js"><link rel="prefetch" href="/assets/js/xiangmugailan.574da0f9.js"><link rel="prefetch" href="/assets/js/xiangmuguanli.310ad8f1.js"><link rel="prefetch" href="/assets/js/xiaochengxu.f21ad17d.js"><link rel="prefetch" href="/assets/js/xingdaimadainishixianxiaochengxuzhongdeshujuzhenting.36b2d444.js"><link rel="prefetch" href="/assets/js/xiwangxiangsu.83a5d95f.js"><link rel="prefetch" href="/assets/js/yemianxingneng.2ea2cfa3.js"><link rel="prefetch" href="/assets/js/yifengchenmo.470e2da1.js"><link rel="prefetch" href="/assets/js/yinmi.279fe74e.js"><link rel="prefetch" href="/assets/js/youguanxinxiangmudifangfalun.12cf868d.js"><link rel="prefetch" href="/assets/js/yuanmajiqiao.3291518f.js"><link rel="prefetch" href="/assets/js/yuanmaxuexi.05e2722f.js"><link rel="prefetch" href="/assets/js/yunnazhuanzhengxiaojie.14fb3712.js"><link rel="prefetch" href="/assets/js/yuwolianluoyouqinglianjie.85cfb916.js"><link rel="prefetch" href="/assets/js/zhongtuanjiexi.9d225297.js"><link rel="prefetch" href="/assets/js/zhuixunziyouyumanhuaixiwang.712b2ef9.js"><link rel="prefetch" href="/assets/js/zuijinwoganjue.4e6a7dab.js">
    <link rel="stylesheet" href="/assets/css/0.styles.68e428c0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">YoochBlog</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/articles/" class="nav-link router-link-active">
  Posts
</a></div><div class="nav-item"><a href="/friends/" class="nav-link">
  Links
</a></div><div class="nav-item"><a href="/maps/" class="nav-link">
  Maps
</a></div><div class="nav-item"><a href="/hire-me/" class="nav-link">
  HireMe
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/articles/" class="nav-link router-link-active">
  Posts
</a></div><div class="nav-item"><a href="/friends/" class="nav-link">
  Links
</a></div><div class="nav-item"><a href="/maps/" class="nav-link">
  Maps
</a></div><div class="nav-item"><a href="/hire-me/" class="nav-link">
  HireMe
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/journal/" class="sidebar-heading clickable open"><span>傻逼日记 / journal</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/journal/DiaryOfAFool.html" class="sidebar-link">☝️🤓 日记</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/ReadMore/" class="sidebar-heading clickable"><span>再读一点 / ReadMore</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/ReadMore/IntimateRelationship.html" class="sidebar-link">❤️‍🩹亲密关系</a></li><li><a href="/ReadMore/GoingOnALongJourneyAtTheAgeOf18.html" class="sidebar-link">🚶‍♂️‍➡️十八岁出门远行</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/flows/" class="sidebar-heading clickable"><span>心流思绪 / Heart Flows</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/flows/LvMaoShuiGuai.html" class="sidebar-link">🧜‍♀️绿毛水怪</a></li><li><a href="/flows/NowADays.html" class="sidebar-link">🎈最近我感觉......</a></li><li><a href="/flows/WhyOnlyRain.html" class="sidebar-link">👩👨为什么只有我这下雨？</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/maps/" class="sidebar-heading clickable"><span>知识骨架 / Maps</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/maps/business/low-code.html" class="sidebar-link">低码</a></li></ul></section></li><li><a href="/articles/" aria-current="page" class="sidebar-link">技术博客 / Coder</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="🌐-anysort-灵活、优雅、无依赖的排序库">🌐 Anysort：灵活、优雅、无依赖的排序库</h1> <nav class="table-of-contents"><ol><li><a href="#anysort灵活-优雅-无依赖的排序库">🌐 Anysort：灵活、优雅、无依赖的排序库</a><ol><li><a href="#歌单排序">歌单排序</a></li><li><a href="#简单解决">简单解决</a><ol><li><a href="#确定问题">确定问题</a></li><li><a href="#简单方案">简单方案</a></li><li><a href="#问题抽象">问题抽象</a></li></ol></li><li><a href="#逐步改进">逐步改进</a><ol><li><a href="#api-优化">API 优化</a></li><li><a href="#自定义排序函数">自定义排序函数</a></li><li><a href="#增加倒序逻辑">增加倒序逻辑</a></li></ol></li><li><a href="#层层抽象">层层抽象</a><ol><li><a href="#优化循环逻辑">优化循环逻辑</a></li><li><a href="#完善排序逻辑">完善排序逻辑</a></li><li><a href="#抽象排序过程">抽象排序过程</a></li></ol></li><li><a href="#完整代码">完整代码</a></li><li><a href="#阅读更多">阅读更多</a></li></ol></li></ol></nav><JJ><p>求求了，救救孩子吧，已经几个月都没过百赞的博客了呜呜呜 ┭┮﹏┭┮</p></JJ> <h2 id="歌单排序">歌单排序</h2> <p>网易云音乐的歌单排序功能十分鸡肋，只能按照歌曲名、歌手名、专辑名排序。别说处理一些复杂的规则了，他连从 Z-A 这种简单的倒序逻辑都搞不定。这对像我这种红星单动不动就几千首曲子或是喜欢给曲子分类、制作歌单的朋友来说简直就是灾难。</p> <figure data-type="image"><img src="https://mgear-image.oss-cn-shanghai.aliyuncs.com/image/other/20210110192313.png?w=30" alt="" loading="lazy"><figcaption>鸡肋的网易云歌单排序功能</figcaption></figure> <p>于是，我写了一个专门用来给歌单中的歌曲排序的爬虫脚本，能够实现各种有意思的排序功能。</p> <p>比方说，<a href="https://music.163.com/#/playlist?id=5445763637" target="_blank" rel="noopener noreferrer">这个歌单</a>的歌曲排序按照以下规则排序：</p> <ol><li>按专辑名称排序</li> <li>再按专辑发布日期排序。</li> <li>再按歌曲时长排序。</li></ol> <figure data-type="image"><img src="https://mgear-image.oss-cn-shanghai.aliyuncs.com/image/other/20210110194331.png?w=70" alt="" loading="lazy"></figure> <p>再举个例子，<a href="https://music.163.com/#/playlist?id=5447666595" target="_blank" rel="noopener noreferrer">这个歌单</a>的曲子按照以下规则排序：</p> <ol><li>按专辑作者名称排序，由于专辑可能有多个作者，优先选择其中有歌手名为“CLOCKWORKS TRACER”的专辑。</li> <li>再按专辑发布日期排序。</li> <li>再按歌曲在对应专辑中的顺序排序。</li></ol> <figure data-type="image"><img src="https://mgear-image.oss-cn-shanghai.aliyuncs.com/image/other/20210110194551.png?w=70" alt="" loading="lazy"></figure> <p>哇哈，这个排序功能比网易云默认的歌单排序强哈，这才真有点意思~ 接下来，我们一步一步来把它实现吧。名称和标语我都想好了，就叫做 <strong>Anysort：灵活、优雅、无依赖的排序库</strong>。</p> <h2 id="简单解决">简单解决</h2> <h3 id="确定问题">确定问题</h3> <p>首先，得确定要解决什么问题。</p> <p>在 JavaScript 中，排序其实是一个非常好写的功能。通过给 Array.prototype.sort 传入自定义排序方法，就能得到按期望顺序排好了的数组。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> nums <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">100000</span><span class="token punctuation">]</span>

<span class="token keyword">function</span> <span class="token function">customCompare</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">&lt;</span> b<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">&gt;</span> b<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">1</span>
  <span class="token keyword">else</span> <span class="token keyword">return</span> <span class="token number">0</span>
<span class="token punctuation">}</span>

nums<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>customCompare<span class="token punctuation">)</span>

<span class="token comment">// 排序结果：[1, 4, 21, 30, 100000]</span>
</code></pre></div><p>可以看到，给 Array.prototype.sort 传入的排序方法 customCompare，最终的返回值要么是 0，要么是 1 或 -1，这个返回值直接的指代了 a 和 b 的排序顺序。也就是说，无需关心 Array.prototype.sort 的具体实现到底是快速排序还是冒泡排序，只需要写一个比较两个值的大小的函数，返回它们的顺序到底是相等（0），还是 a 比 b 靠前（-1），或是 a 在 b 之后（1）就行了。</p> <p>我们通常会使用 JSON 对象去描述一首曲子，比如<a href="https://music.163.com/#/song?id=347230" target="_blank" rel="noopener noreferrer">《海阔天空》</a>可能描述如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> song <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'海阔天空'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">authro</span><span class="token operator">:</span> <span class="token string">'Beyond'</span><span class="token punctuation">,</span>
  <span class="token comment">// 专辑信息</span>
  <span class="token literal-property property">album</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'海阔天空'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token string">'1993-09-09'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">brief</span><span class="token operator">:</span> <span class="token string">'《海阔天空》是黄家驹为BEYOND成立十周年而作的，刻画着他们十年来的心路历程。'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 评论信息</span>
  <span class="token literal-property property">comments</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'冰凍七音'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">'有些人死了，他还活着'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">approve</span><span class="token operator">:</span> <span class="token string">'150283'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">hot</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'独坐凭栏'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">'钢铁锅，含着泪喊修瓢锅。。。'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">approve</span><span class="token operator">:</span> <span class="token string">'77739'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>给歌曲排序可要比给数字排序复杂。两个数字之间固然只有大于小于等于三种关系，但是同一首专辑的歌曲之间，也许我们还想继续按歌曲名、歌曲时间或其它属性排序。讲到这里，写排序函数时碰到的第一个问题就出来了：如何给多属性进行排序？</p> <h3 id="简单方案">简单方案</h3> <p>先简单来写几个基础排序函数，尝试解决以下问题：</p> <ol><li>先按曲子的专辑名称的长度排序。</li> <li>再按曲子的名称的字典顺序排序。</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">sortByAlbumNameLen</span><span class="token punctuation">(</span><span class="token parameter">songA<span class="token punctuation">,</span> songB</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> lenA <span class="token operator">=</span> songA<span class="token punctuation">.</span>album<span class="token punctuation">.</span>name<span class="token punctuation">.</span>length
  <span class="token keyword">const</span> lenB <span class="token operator">=</span> songB<span class="token punctuation">.</span>album<span class="token punctuation">.</span>name<span class="token punctuation">.</span>length
  <span class="token comment">// 专辑名称相同，则不改变顺序（0），名称不相同时，则按照专辑名称的长度由短到长排列。</span>
  <span class="token keyword">return</span> lenA <span class="token operator">===</span> lenB <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token punctuation">(</span>lenA <span class="token operator">&lt;</span> lenB <span class="token operator">?</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> songs <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'songB'</span><span class="token punctuation">,</span> <span class="token literal-property property">album</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'wow'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'songC'</span><span class="token punctuation">,</span> <span class="token literal-property property">album</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'other'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'songA'</span><span class="token punctuation">,</span> <span class="token literal-property property">album</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'wow'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
songs<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>sortByAlbumNameLen<span class="token punctuation">)</span>
<span class="token comment">// 得到结果：songB、songA、songC</span>
</code></pre></div><p>然后再来处理专辑名称相同的情况。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">sortBySongName</span><span class="token punctuation">(</span><span class="token parameter">songA<span class="token punctuation">,</span> songB</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> nameA <span class="token operator">=</span> songA<span class="token punctuation">.</span>name
  <span class="token keyword">const</span> nameB <span class="token operator">=</span> songB<span class="token punctuation">.</span>name
  <span class="token comment">// 根据曲子的名称的字典顺序排序，如 'abort' 排在 'bank' 前面。</span>
  <span class="token keyword">return</span> nameA <span class="token operator">===</span> nameB <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token punctuation">(</span>nameA <span class="token operator">&lt;</span> nameB <span class="token operator">?</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>由于 Array.prototype.sort 方法只接受一个函数，所以，需要把 sortByAlbumNameLen 和 sortBySongName 两个函数合二为一。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">sortByAlbumLenThenSongName</span><span class="token punctuation">(</span><span class="token parameter">songA<span class="token punctuation">,</span> songB</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> firstRes <span class="token operator">=</span> <span class="token function">sortByAlbumNameLen</span><span class="token punctuation">(</span>songA<span class="token punctuation">,</span> songB<span class="token punctuation">)</span>
  <span class="token comment">// 先以 sortByAlbumNameLen 的结果为准，</span>
  <span class="token comment">// 如果 sortByAlbumNameLen 没能得出顺序，</span>
  <span class="token comment">// 返回了 0，</span>
  <span class="token comment">// 那么继续排序，以 sortBySongName 的结果为准</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>firstRes <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> firstRes
  <span class="token keyword">else</span> <span class="token keyword">return</span> <span class="token function">sortBySongName</span><span class="token punctuation">(</span>songA<span class="token punctuation">,</span> songB<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> songs <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'songB'</span><span class="token punctuation">,</span> <span class="token literal-property property">album</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'wow'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'songC'</span><span class="token punctuation">,</span> <span class="token literal-property property">album</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'other'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'songA'</span><span class="token punctuation">,</span> <span class="token literal-property property">album</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'wow'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
songs<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>sortByAlbumNameLen<span class="token punctuation">)</span>
<span class="token comment">// 得到结果：</span>
<span class="token comment">// [</span>
<span class="token comment">//   { name: 'songA', album: { name: 'wow' } },</span>
<span class="token comment">//   { name: 'songB', album: { name: 'wow' } },</span>
<span class="token comment">//   { name: 'songC', album: { name: 'other' } },</span>
<span class="token comment">// ]</span>
</code></pre></div><p>搞定。目前为止，先按曲子的专辑名称的长度排序，再按曲子的名称的字典顺序排序这个小功能就写好了。</p> <h3 id="问题抽象">问题抽象</h3> <p>有一个问题比较烦人，就是 Array.prototype.sort 只接受一个参数用作排序函数，还不能是数组。所以只要更改了排序的规则，那么传进去的参数（即上面的 sortByAlbumLenThenSongName）的逻辑就得跟着改。</p> <p>这个小麻烦可以通过抽象解决。仔细观察，sortByAlbumLenThenSongName 的逻辑是：先按 sortByAlbumNameLen 的规则排序，如果 sortByAlbumNameLen 没能给出现后顺序（即返回 0），那么再按 sortBySongName 的顺序排序。这种现后顺序，不就是一个循环嘛！</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">sortBy</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>sortFns</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token parameter">obj1<span class="token punctuation">,</span> obj2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> fnsLen <span class="token operator">=</span> sortFns<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
      result <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
      i <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>result <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> i <span class="token operator">&lt;</span> fnsLen<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      result <span class="token operator">=</span> <span class="token function">sort</span><span class="token punctuation">(</span>sortFns<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">(</span>obj1<span class="token punctuation">,</span> obj2<span class="token punctuation">)</span>
      i<span class="token operator">++</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> result
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
songs<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token function">sortBy</span><span class="token punctuation">(</span>
  sortByAlbumNameLen<span class="token punctuation">,</span> 
  sortBySongName
<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>以后，就算我们继续更改排序规则，也不需要写新的函数去重构传入 Array.prototype.sort 的那个方法。假设替换一条排序规则：</p> <ol><li>先按曲子的专辑名称的长度排序。</li> <li><del>再按曲子的名称的字典顺序排序。</del></li> <li>再按曲子的时长排序。</li></ol> <p>只需要改动以下几行代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ...</span>
<span class="token keyword">function</span> <span class="token function">sortBySongTime</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a<span class="token punctuation">.</span>time <span class="token operator">===</span> b<span class="token punctuation">.</span>time <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span>time <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>time <span class="token operator">?</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// ...</span>
songs<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token function">sortBy</span><span class="token punctuation">(</span>
  sortByAlbumNameLen<span class="token punctuation">,</span>
  sortBySongTime
<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>妙哉妙哉~</p> <h2 id="逐步改进">逐步改进</h2> <p>上一小节，我们简单完成了一个具有多属性排序功能。接下来需进一步完善这个排序函数，使其功能完整，更加强大。</p> <h3 id="api-优化">API 优化</h3> <p>程序员都是懒惰的。其实我甚至连基础的排序函数都不想写，要是能直接传入待排序的属性名那多好哇：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> songs <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'songB'</span><span class="token punctuation">,</span> <span class="token literal-property property">album</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'wow'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'songC'</span><span class="token punctuation">,</span> <span class="token literal-property property">album</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'other'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'songA'</span><span class="token punctuation">,</span> <span class="token literal-property property">album</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'wow'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
<span class="token comment">// 先按专辑名称、再按曲子名正序排列</span>
songs<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>
  <span class="token function">sortBy</span><span class="token punctuation">(</span><span class="token string">'album.name'</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token comment">// Results：songA、songB、songC</span>
</code></pre></div><p>也就是说，需要写一个读取对象的属性值的方法。既然是涉及属性存取符号（也就是点运算符），那我们就用 eval('song.album.name') 就能读到属性啦。咳咳，划掉，动态语言不意味着就要用 eval 解决问题。当然了，new Function 也不行。以下继续写一个 while 循环吧。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">getVal</span> <span class="token operator">=</span> <span class="token parameter">name</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> pathsStore <span class="token operator">=</span> name<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token parameter">x</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> paths <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>pathsStore<span class="token punctuation">]</span>
    <span class="token keyword">let</span> val <span class="token operator">=</span> x
    <span class="token keyword">while</span> <span class="token punctuation">(</span>val <span class="token operator">&amp;&amp;</span> paths<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      next <span class="token operator">=</span> paths<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      val <span class="token operator">=</span> val<span class="token punctuation">[</span>next<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> val
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">getVal</span><span class="token punctuation">(</span><span class="token string">'b.c'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token string">'test'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
<span class="token comment">// Results：'test'</span>
</code></pre></div><p>再接下来只要重构 sortBy 函数，把 getVal 的逻辑添加进去，就完成传入字符串属性的改造啦。</p> <h3 id="自定义排序函数">自定义排序函数</h3> <p>现在可以传入字符串了，我们再加一种 API：自定义排序函数，以支持某些特殊排序逻辑。比如以下代码：</p> <div class="language-js extra-class"><pre class="language-js"><code>songs<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token function">sortBy</span><span class="token punctuation">(</span>
  <span class="token comment">// 优先选择 2020 年发布的曲子，并按时间倒序排列</span>
  <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> year2019 <span class="token operator">=</span> <span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">'2019-12-31 23:59:59'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> year2020 <span class="token operator">=</span> <span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">'2020-12-31 23:59:59'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> timeA <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>year2019<span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>pubTime<span class="token punctuation">,</span> year2020<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> timeB <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>year2019<span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>pubTime<span class="token punctuation">,</span> year2020<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> timeA <span class="token operator">===</span> timeB <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token punctuation">(</span> timeA <span class="token operator">&lt;</span> timeB <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 再按专辑名称排序</span>
  <span class="token string">'album.name'</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>这个改造其实并不难，判断一下传入参数的类型就好了。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 由于 sortBy 函数返回一个排序函数，</span>
<span class="token comment">// 所以在这儿改名为 factory（函数工厂）</span>
<span class="token keyword">function</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>cmd</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 如果没有排序参数，那么返回 undefined，</span>
  <span class="token comment">// 告诉 Array.prototype.sort 不需要排序</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>cmd<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">undefined</span>

  <span class="token comment">// 兼容字符串或自定义函数</span>
  <span class="token keyword">const</span> sortFns <span class="token operator">=</span> cmd<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
    x <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">?</span> x <span class="token operator">:</span> <span class="token function">generate</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
  <span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">obj1<span class="token punctuation">,</span> obj2</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> fnsLen <span class="token operator">=</span> sortFns<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
      result <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
      i <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>result <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> i <span class="token operator">&lt;</span> fnsLen<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      result <span class="token operator">=</span> <span class="token function">sort</span><span class="token punctuation">(</span>sortFns<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">(</span>obj1<span class="token punctuation">,</span> obj2<span class="token punctuation">)</span>
      i<span class="token operator">++</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> result
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 从字符串指令（如 album.name）中得到排序函数</span>
<span class="token keyword">function</span> <span class="token function">generate</span><span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 指定排序是正序还是倒序，稍后会用到</span>
  <span class="token keyword">const</span> sortOrder <span class="token operator">=</span> <span class="token number">1</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> result
    <span class="token keyword">var</span> am <span class="token operator">=</span> <span class="token function">getVal</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
    <span class="token keyword">var</span> bm <span class="token operator">=</span> <span class="token function">getVal</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>am <span class="token operator">===</span> bm<span class="token punctuation">)</span> result <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>am <span class="token operator">&lt;</span> bm<span class="token punctuation">)</span> result <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>am <span class="token operator">&gt;</span> bm<span class="token punctuation">)</span> result <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">return</span> result <span class="token operator">*</span> sortOrder
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="增加倒序逻辑">增加倒序逻辑</h3> <p>在 generate 函数里，我们还遗留了一个字段 sortOrder 用来指定排序是正序还是倒序。当然，如果传入自定义排序函数，根本不会走 generate，只有字符串参数，才会走到这一步。这里可以改进一下 API，如传入 '-album.name'，前面加了一个负号，用来代表按倒序排序。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">generate</span><span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> sortOrder <span class="token operator">=</span> <span class="token number">1</span>
  <span class="token comment">// 如果第一个字符为负号，则将排序结果取反</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'-'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sortOrder <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
    s <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> result
    <span class="token keyword">var</span> am <span class="token operator">=</span> <span class="token function">getVal</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
    <span class="token keyword">var</span> bm <span class="token operator">=</span> <span class="token function">getVal</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>am <span class="token operator">===</span> bm<span class="token punctuation">)</span> result <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>am <span class="token operator">&lt;</span> bm<span class="token punctuation">)</span> result <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>am <span class="token operator">&gt;</span> bm<span class="token punctuation">)</span> result <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">return</span> result <span class="token operator">*</span> sortOrder
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>奈斯哇，经过这两次迭代，终于支持了自定义排序函数，也支持通过负号得到倒序的逻辑。</p> <p>不过，这可远远没有结束，第三小节才是“真正的 Coding”。</p> <h2 id="层层抽象">层层抽象</h2> <p>坐稳啦，🚀 开始加速了！</p> <h3 id="优化循环逻辑">优化循环逻辑</h3> <p>还记得我们怎么使用循环来解决两个不同的排序方法之间的顺序问题吗？按顺序传入排序函数，然后依次调用这些排序函数，如果没有得到两个值的现后顺序，那么就以下一个排序函数的结果为准：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">sortBy</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>sortFns</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token parameter">obj1<span class="token punctuation">,</span> obj2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> fnsLen <span class="token operator">=</span> sortFns<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
      result <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
      i <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token comment">// 注意停止条件</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>result <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> i <span class="token operator">&lt;</span> fnsLen<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      result <span class="token operator">=</span> <span class="token function">sort</span><span class="token punctuation">(</span>sortFns<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">(</span>obj1<span class="token punctuation">,</span> obj2<span class="token punctuation">)</span>
      i<span class="token operator">++</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> result
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这里可以用一行 Reduce 函数直接搞定整整一片代码逻辑。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">sortBy</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>sortFns</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 非常耐人寻味</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> sortFns<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token parameter">result<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> result <span class="token operator">||</span> <span class="token function">fn</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="完善排序逻辑">完善排序逻辑</h3> <p>我们在 generate 函数中写死了值的比较方法。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>am <span class="token operator">===</span> bm<span class="token punctuation">)</span> result <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>am <span class="token operator">&lt;</span> bm<span class="token punctuation">)</span> result <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>am <span class="token operator">&gt;</span> bm<span class="token punctuation">)</span> result <span class="token operator">=</span> <span class="token number">1</span>
</code></pre></div><p>大于、小于、等于三种逻辑虽然完备，但那是针对“数值”的比较而言的。如果比较的值不是数字，你就会发现，使用关系运算符会出现一些奇怪的情况。</p> <div class="language-js extra-class"><pre class="language-js"><code>songs <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">'9'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">'10'</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
<span class="token string">'10'</span> <span class="token operator">&lt;</span> <span class="token string">'9'</span> <span class="token comment">// true</span>
<span class="token string">'9'</span> <span class="token operator">&lt;</span> <span class="token string">'10'</span> <span class="token comment">// false</span>
</code></pre></div><p>如果 songs 结构中有字符串的比较，那事情不好办。因为字符串的比较可能不是按照你期望的逻辑进行的，它按字典顺序，所以字符串 9 会大于字符串 10。如果不想写自定义函数的话，需要改进 API，指定属性比较前先强制转换为数字而不是直接使用字符串进行比较。</p> <p>再看一个例子。</p> <div class="language-js extra-class"><pre class="language-js"><code>songs <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">'0'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>         <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">'2'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">'3'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
<span class="token keyword">undefined</span> <span class="token operator">===</span> <span class="token string">'value'</span> <span class="token comment">// false</span>
<span class="token keyword">undefined</span> <span class="token operator">&lt;</span> <span class="token string">'value'</span> <span class="token comment">// false</span>
<span class="token keyword">undefined</span> <span class="token operator">&gt;</span> <span class="token string">'value'</span> <span class="token comment">// false</span>
</code></pre></div><p>如果某首曲子没有专辑名称这个字段，会从 song.album.name 得到空值。空值和任何非空值比较都返回 false，于是，没有 id 的曲子会被排到最上面。所以改进 API 指定空值的排序顺序非常迫切呀。</p> <p>以下，需要将排序逻辑，也就是比较值的算法单独抽出来。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 判断 null 和 undefined</span>
<span class="token keyword">const</span> <span class="token function-variable function">isVoid</span> <span class="token operator">=</span> <span class="token parameter">x</span> <span class="token operator">=&gt;</span> x <span class="token operator">==</span> <span class="token keyword">undefined</span>
<span class="token comment">// 获取一个数的类型，如 'function'、'object' 等</span>
<span class="token keyword">const</span> <span class="token function-variable function">getType</span> <span class="token operator">=</span> <span class="token parameter">x</span> <span class="token operator">=&gt;</span> <span class="token function">isVoid</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> 
  <span class="token operator">?</span> <span class="token string">'void'</span> 
  <span class="token operator">:</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span>
    <span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> by <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 默认逻辑排序</span>
  <span class="token function-variable function">default</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> typeA <span class="token operator">=</span> <span class="token function">getType</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
    <span class="token keyword">const</span> typeB <span class="token operator">=</span> <span class="token function">getType</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
    <span class="token comment">// 如果两个数中有一个是空值，则把空值放到后面</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>typeA <span class="token operator">===</span> <span class="token string">'void'</span> <span class="token operator">||</span> typeB <span class="token operator">===</span> <span class="token string">'void'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> by<span class="token punctuation">.</span><span class="token function">void</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> typeA<span class="token punctuation">,</span> typeB<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// 某些不能进行比较的类型（如 '{}' 和 '{}'），</span>
      <span class="token comment">// 需要报警告，并忽略此次比较的顺序</span>
      <span class="token comment">// constructor 的作用稍后介绍</span>
      <span class="token keyword">const</span> canSort <span class="token operator">=</span> constructor<span class="token punctuation">[</span>typeA<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> typeA <span class="token operator">===</span> typeB
      <span class="token operator">!</span>canSort <span class="token operator">&amp;&amp;</span> console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[TIP] 不能排序对 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>a<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 和 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>b<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 排序，忽略此次比较。你可以传入自定义排序函数对对象进行排序。</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> canSort
        <span class="token comment">// 正常比较</span>
        <span class="token operator">?</span> by<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span>typeA<span class="token punctuation">)</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
        <span class="token comment">// 跳过比较</span>
        <span class="token operator">:</span> <span class="token keyword">undefined</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 空值的比较函数比较好理解，</span>
  <span class="token comment">// 两个都是空值则没有先后顺序</span>
  <span class="token comment">// 如果只有一个空值，那么将空值放到后面</span>
  <span class="token function-variable function">void</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> ta<span class="token punctuation">,</span> tb</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ta <span class="token operator">===</span> tb<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">1</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 正常比较以值的类型为准</span>
  <span class="token comment">// 为了防止属性中出现不同的值类型的情况，</span>
  <span class="token comment">// 需要将值做一次转换（强制转换）</span>
  <span class="token comment">// 假设我们需要比较 Symbol 的值，那就需要将其先转成字符串，</span>
  <span class="token comment">// constructor 的作用正是类似于强制转换函数，</span>
  <span class="token comment">// 比如 symbol 的强制转换，</span>
  <span class="token comment">// 等同于将 Symbol('x') 进行 Symbol('x').toString() 处理</span>
  <span class="token function-variable function">type</span><span class="token operator">:</span> <span class="token parameter">type</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> Type <span class="token operator">=</span> <span class="token function">isFn</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token operator">?</span> type <span class="token operator">:</span> constructor<span class="token punctuation">[</span>type<span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Type<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Error occured when compare value </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>a<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> with value </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>b<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> va <span class="token operator">=</span> <span class="token function">Type</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> vb <span class="token operator">=</span> <span class="token function">Type</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
    <span class="token keyword">return</span> va <span class="token operator">===</span> vb <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token punctuation">(</span>va <span class="token operator">&lt;</span> vb <span class="token operator">?</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> constructor <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">date</span><span class="token operator">:</span> <span class="token parameter">x</span> <span class="token operator">=&gt;</span> <span class="token operator">+</span>x<span class="token punctuation">,</span>
  <span class="token literal-property property">string</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
  <span class="token literal-property property">number</span><span class="token operator">:</span> Number<span class="token punctuation">,</span>
  <span class="token literal-property property">boolean</span><span class="token operator">:</span> Boolean<span class="token punctuation">,</span>
  <span class="token function-variable function">symbol</span><span class="token operator">:</span> <span class="token parameter">x</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>完善排序逻辑后，我们的比较函数终于能支持各种特殊值的比较啦。对于不能比较的值，也会报警提醒我们比较过程可能出了问题。</p> <figure data-type="image"><img src="https://mgear-image.oss-cn-shanghai.aliyuncs.com/image/other/20210110234658.png" alt="" loading="lazy"><figcaption>不能比较的值也会报警告</figcaption></figure> <h3 id="抽象排序过程">抽象排序过程</h3> <p>在开始最难的部分之前，先完整过一遍排序的主要流程。</p> <p>工厂函数支持传入字符串或是自定义函数。传入的字符串形如：album.name。如果是字符串的话，会通过 generate 函数生成一个新的排序函数。如果字符串是 -album.name，那么还会调用特殊逻辑，将排序结果反转。总之，工厂函数会按字参数返回新的排序函数。</p> <p><strong>请你想象，在此之上的抽象是什么？</strong></p> <p>传入字符串，无非是为了支持“命令式”排序。字符转可以看成“指令”。每一个指令，都对应一种特定的排序方法。比如说，负号指代“将排序顺序反转的方法”，album.name 指代“从对象中取出 album.name 的值的方法”。</p> <p>当然，我还可以列出更多：</p> <ul><li>正序：原样返回排序结果的方法</li> <li>倒序：将排序顺序反转的方法</li> <li>随机排序：返回随机结果的方法</li> <li>空值排序：将空值的顺序放到非空值后面的方法</li> <li>字典排序：按照字典顺序返回排序结果的方法</li> <li>属性长度：获取字段的值长度的方法</li> <li>属性包含：获取判断字段的值是否包含某值的方法</li> <li>属性判断：获取判断字段的值是否等于某值的方法</li> <li>...</li></ul> <p>无论列举多少种新的方法，都可以归类为两种形式：</p> <ul><li>解构形式：处理排序参数的函数</li> <li>插件形式：处理排序结果的函数</li></ul> <p>其实，两种形式都对应了一种特殊的代码结构。</p> <p>解构好理解，解构是一种能接受排序函数，再接受排序参数，然后返回使用排序函数处理解构函数处理过的参数的结果的形式。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 以获取歌曲名称插件举例</span>
<span class="token keyword">const</span> <span class="token function-variable function">mapFn</span> <span class="token operator">=</span> <span class="token parameter">song</span> <span class="token operator">=&gt;</span> song<span class="token punctuation">.</span>name
<span class="token keyword">const</span> <span class="token function-variable function">getNameMap</span> <span class="token operator">=</span> <span class="token parameter">sortFn</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">sortFn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">.</span><span class="token function">mapFn</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> <span class="token function">mapFn</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>插件的定义则稍微有点绕：插件是一种能接受排序函数，再接受排序参数，然后返回使用插件逻辑处理排序函数处理的排序参数的结果的形式。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 以倒序插件举例</span>
<span class="token keyword">const</span> <span class="token function-variable function">plugFn</span> <span class="token operator">=</span> <span class="token parameter">fn</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">-</span><span class="token function">fn</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">descendSort</span> <span class="token operator">=</span> <span class="token parameter">sortFn</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">plugFn</span><span class="token punctuation">(</span><span class="token function">sortFn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>理解以上定义后，我们会得到“用来创建插件的函数”和“用来创建解构的函数”：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">plugin</span> <span class="token operator">=</span> 
  <span class="token parameter">plugFn</span> <span class="token operator">=&gt;</span> 
  <span class="token parameter">sortFn</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">plugFn</span><span class="token punctuation">(</span><span class="token function">sortFn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">mapping</span> <span class="token operator">=</span> 
  <span class="token parameter">mapFn</span> <span class="token operator">=&gt;</span> 
  <span class="token parameter">sortFn</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">sortFn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">.</span><span class="token function">mapFn</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> <span class="token function">mapFn</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>我将“插件（形式）”和“解构（形式）”统称为：插件。</p> <p>也就是说，传入的字符串，最终都会经过 generate 函数处理以得到某种插件。所以，按照这种逻辑，字符串 API，也就是指令，能实现形式上的统一：</p> <ul><li>album.name：解构插件，即 song =&gt; song.album.name</li> <li>name-dec()：解构插件+倒序插件，即 song =&gt; song.name 加上 sortFn =&gt; (...args) =&gt; -sortFn(...args)</li> <li>name-is(Lionad)：解构插件+属性判断插件，即 song =&gt; song.name 加上 name =&gt; name === 'Lionad'</li></ul> <p>题外话：希望到这里我还能讲得清楚。如果大家已经晕了的话，可以直接拉到文末看源码，也许源码的结构看起来要比我讲得反而更清楚些。</p> <p>我们先改造 generate 函数，使其支持同一类型的 API，也就是，中横线将作为指令间插件的分割，不再是指代将结果取反。</p> <p>首先，每一个指令都需要一个数组去存储插件。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 指令中的插件作为数组元素存放在 Sort 实例中的 pipeline（流水线）字段中。</span>
<span class="token keyword">function</span> <span class="token function">Sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>pipeline <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token comment">// 给指令添加一个解构插件</span>
<span class="token class-name">Sort</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">map</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">_value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>pipeline<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _value<span class="token punctuation">,</span> <span class="token literal-property property">_type</span><span class="token operator">:</span> <span class="token string">'map'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// 返回 this 以支持链式调用</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span>
<span class="token punctuation">}</span>
<span class="token comment">// 给指令添加一个插件</span>
<span class="token class-name">Sort</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">plugin</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">_value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>pipeline<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _value<span class="token punctuation">,</span> <span class="token literal-property property">_type</span><span class="token operator">:</span> <span class="token string">'plugin'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span>
<span class="token punctuation">}</span>
</code></pre></div><p>接下来改造 generate。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 从字符串指令中得到排序函数</span>
<span class="token keyword">function</span> <span class="token function">generate</span><span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 创造一个新的排序指令实例</span>
  <span class="token keyword">const</span> sort <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> <span class="token punctuation">[</span><span class="token operator">...</span>actions<span class="token punctuation">]</span> <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span>
  actions <span class="token operator">=</span> actions<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">action</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 使用这个方法，匹配出插件名和插件参数</span>
      <span class="token comment">// 如 album.name 的名称为 album.name，参数为空</span>
      <span class="token comment">// 又如 is(Lionad) 的名称为 is，参数为 Lionad</span>
      <span class="token keyword">const</span> <span class="token punctuation">[</span>all<span class="token punctuation">,</span> name<span class="token punctuation">,</span> argsWithQuote<span class="token punctuation">,</span> args<span class="token punctuation">]</span> <span class="token operator">=</span> action<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">([^(]+)(\(([^)]*)\))?</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span>
      <span class="token comment">// 所有没有带括号的插件，都会被当成属性解构插件</span>
      <span class="token comment">// 如 name-is 是 song =&gt; song.name 和 song =&gt; song.is 的结合，</span>
      <span class="token comment">// 是没有意义的，这样写还不如拆分成两个指令，</span>
      <span class="token comment">// name 指令和 is 指令，再依次排序</span>
      <span class="token keyword">const</span> plugin <span class="token operator">=</span> argsWithQuote
        <span class="token operator">?</span> defaultPlugin<span class="token punctuation">[</span>name<span class="token punctuation">]</span>
        <span class="token comment">// defaultPlugin 接下来会说明</span>
        <span class="token operator">:</span> defaultPlugin<span class="token punctuation">.</span><span class="token function">default</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>

      <span class="token function">plugin</span><span class="token punctuation">(</span>sort<span class="token punctuation">,</span> args <span class="token operator">||</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> sort
<span class="token punctuation">}</span>
</code></pre></div><p>defaultPlugin 也就是内置的插件，来看看它的实现：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> plugins <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 倒序插件</span>
  <span class="token function-variable function">dec</span><span class="token operator">:</span> <span class="token parameter">sort</span> <span class="token operator">=&gt;</span> sort<span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token parameter">fn</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">-</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// 属性判断插件</span>
  <span class="token literal-property property">is</span><span class="token operator">:</span> <span class="token punctuation">(</span>sort<span class="token punctuation">,</span> args <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> sort<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x <span class="token operator">===</span> args<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sortby</span><span class="token punctuation">(</span><span class="token string">'boolean'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// 解构插件，处理对象的属性如 'a.b.c' 的值</span>
  <span class="token function-variable function">default</span><span class="token operator">:</span> <span class="token parameter">name</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> pathsStore <span class="token operator">=</span> name<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token function-variable function">getVal</span> <span class="token operator">=</span> <span class="token parameter">x</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> paths <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>pathsStore<span class="token punctuation">]</span>
      <span class="token keyword">let</span> val <span class="token operator">=</span> x
      <span class="token keyword">while</span> <span class="token punctuation">(</span>val <span class="token operator">&amp;&amp;</span> paths<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        next <span class="token operator">=</span> paths<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        val <span class="token operator">=</span> val<span class="token punctuation">[</span>next<span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> val
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token parameter">sort</span> <span class="token operator">=&gt;</span> sort<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>getVal<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 指令实例使用 compare 字段保存排序逻辑</span>
<span class="token comment">// 比如 sortBy('number') 表示，</span>
<span class="token comment">// 结果将按 a === b ? 0 : (a &lt; b -1 : 1) 的形式排序</span>
<span class="token class-name">Sort</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sortby</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>compare <span class="token operator">=</span> <span class="token function">isFn</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token operator">?</span> fn <span class="token operator">:</span> by<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span>fn<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>现在，假设有以下数据进行排序。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> songs <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'shanghai'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'beijing'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'home'</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
songs<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token function">factory</span><span class="token punctuation">(</span><span class="token string">'name-is(home)'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// Results：</span>
<span class="token comment">// [ </span>
<span class="token comment">//   { name: 'shanghai' },</span>
<span class="token comment">//   { name: 'beijing' },</span>
<span class="token comment">//   { name: 'home' } // !?</span>
<span class="token comment">// ]</span>
</code></pre></div><p>因为 true 总是大于 false，所以虽然我们的语义上是希望 true 排在 false 前面，但是不能得所愿。</p> <p>所以 constructor 需要改进一下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> constructor <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">date</span><span class="token operator">:</span> <span class="token parameter">x</span> <span class="token operator">=&gt;</span> <span class="token operator">+</span>x<span class="token punctuation">,</span>
  <span class="token literal-property property">string</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
  <span class="token literal-property property">number</span><span class="token operator">:</span> Number<span class="token punctuation">,</span>
  <span class="token comment">// 看这里！</span>
  <span class="token comment">// 布尔值在比较前需取反处理</span>
  <span class="token comment">// 这样才能得到语义上正确的结果</span>
  <span class="token function-variable function">boolean</span><span class="token operator">:</span> <span class="token parameter">x</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>x<span class="token punctuation">,</span>
  <span class="token function-variable function">symbol</span><span class="token operator">:</span> <span class="token parameter">x</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>抽象排序过程的最后一步，我们需要把指令中所有的插件融合成一个新的排序函数，就像主函数 factory 做的那样。这个函数叫做 seal 封装。</p> <p>对 factory 来说，传入字符串指令和自定义排序函数是等价的，可以把插件返回的最终函数也等价于一个自定义排序函数，也就是封装函数的返回值等价于 (a, b) =&gt; a - b 这种形式。等等，这正是 this.compare！那逻辑就清晰了，seal 把流水线中的所有插件打包成一个，能接受排序函数，再接受排序参数，然后返回排序函数处理排序参数的结果的函数。</p> <p>“能接受排序函数，再接受排序参数，然后返回排序函数处理排序参数的结果的函数”，用代码表示就是：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">pass</span> <span class="token operator">=</span> <span class="token parameter">sortFn</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">sortFn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span>
</code></pre></div><p>接下来，继续完善 seal 函数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Sort</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">seal</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 如果一个指令没有定义排序逻辑，那么走默认排序逻辑，</span>
  <span class="token comment">// 即先获取参数类型，再判断能不能比较、要不要 console.warn 那段逻辑</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>compare <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>compare <span class="token operator">||</span> by<span class="token punctuation">.</span>default

  <span class="token keyword">const</span> <span class="token function-variable function">pass</span> <span class="token operator">=</span> <span class="token parameter">sortFn</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">sortFn</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pipeline
    <span class="token comment">// 处理流水线，返回 pass 形式的函数</span>
    <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">/* whatever */</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> initValue<span class="token punctuation">)</span>
    <span class="token comment">// 再传入排序函数</span>
    <span class="token comment">// 最终返回形如 (a, b) =&gt; this.compare(a, b) 的函数</span>
    <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>compare<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>额，<strong>(⊙﹏⊙)</strong>，所以 seal 中的 reduce 到底怎么写？</p> <p>你还记得之前是怎么定义的向流水线中添加插件的函数吗。也就是 Sort.prototype.map 和 Sort.prototype.plugin：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Sort</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">map</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">_value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>pipeline<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _value<span class="token punctuation">,</span> <span class="token literal-property property">_type</span><span class="token operator">:</span> <span class="token string">'map'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token class-name">Sort</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">plugin</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">_value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>pipeline<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _value<span class="token punctuation">,</span> <span class="token literal-property property">_type</span><span class="token operator">:</span> <span class="token string">'plugin'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>流水线中每一个值，都有元属性 _type 去指代它到底是解构还是插件，所以需要在 seal 中有针对性地处理这两种情况。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Sort</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">seal</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>compare <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>compare <span class="token operator">||</span> by<span class="token punctuation">.</span>default

  <span class="token keyword">const</span> <span class="token function-variable function">pass</span> <span class="token operator">=</span> <span class="token parameter">sortFn</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">sortFn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token function-variable function">plugin</span> <span class="token operator">=</span> <span class="token parameter">plug</span> <span class="token operator">=&gt;</span> <span class="token parameter">sortFn</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">plug</span><span class="token punctuation">(</span><span class="token function">sortFn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token function-variable function">mapping</span> <span class="token operator">=</span> <span class="token parameter">map</span> <span class="token operator">=&gt;</span> <span class="token parameter">sortFn</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">sortFn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> <span class="token function">map</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pipeline<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">lastSortFn<span class="token punctuation">,</span> current</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> _type<span class="token punctuation">,</span> _value <span class="token punctuation">}</span> <span class="token operator">=</span> current
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_type <span class="token operator">===</span> <span class="token string">'map'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">mapping</span><span class="token punctuation">(</span><span class="token function">lastSortFn</span><span class="token punctuation">(</span>_value<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_type <span class="token operator">===</span> <span class="token string">'plugin'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">plugin</span><span class="token punctuation">(</span>_value<span class="token punctuation">)</span><span class="token punctuation">(</span>lastSortFn<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> pass<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>compare<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>先以 song =&gt; song.name 这个插件举例：mapping 接受一个解构，返回 pass 形式函数，所以只需要将插件的值 _value 传给 mapping 就好了，即 mapping(_value)。</p> <p>再以倒序插件，也就是 fn =&gt; (a, b) =&gt; -fn(a, b) 举例：plugin 接受一个插件，并返回 pass 形式函数，所以只需要将插件的值 _value 传给 plugin 就好了，即 plugin(_value)。</p> <p>！Σ(っ °Д °;)っ 既然 mapping(_value) 和 plugin(_value) 就好了，那么 mapping(lastSortFn(_value)) 以及 plugin(_value)(lastSortFn) 是什么鬼？</p> <p>这其实是将 pass 函数调用一次，像剥洋葱一样，去掉了一层结构，使得 pipeline 中存在多个插件时，排序的逻辑能一直传递下去（也就是为什么它叫 pass，跳过函数）。这里玩一个小小的游戏：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 定义一个打印函数</span>
<span class="token keyword">const</span> <span class="token function-variable function">log</span> <span class="token operator">=</span> <span class="token parameter">info</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span>
<span class="token comment">// 定义 pass 函数</span>
<span class="token keyword">const</span> <span class="token function-variable function">pass</span> <span class="token operator">=</span> <span class="token parameter">fn</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span>
<span class="token comment">// 无论我们将 anotherLog 封多少层 pass...</span>
<span class="token keyword">const</span> anotherLog <span class="token operator">=</span> <span class="token function">pass</span><span class="token punctuation">(</span><span class="token function">pass</span><span class="token punctuation">(</span><span class="token function">pass</span><span class="token punctuation">(</span><span class="token function">pass</span><span class="token punctuation">(</span>log<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 最终，anotherLog 作用和原打印函数都是一致的</span>
<span class="token function">anotherLog</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span>
<span class="token comment">// 'test'</span>
</code></pre></div><p>最后，简单提及一下为什么 Reduce 最终要返回 pass 形式函数，因为需要一个 pass 去接受 this.compare。</p> <p>好吧，终于把 Anysort 写完了，可以任意跑、任意排序了。</p> <p>题外话：也许在函数式编程的概念中，pass 是已知的一种模式。（也就是说如此一来，pass 就成了某种模式的拙劣模仿。）还请各大佬批评斧正...</p> <h2 id="完整代码">完整代码</h2> <p>Anysort 本来是写在我的网易云爬虫脚本里面的，不过总感觉这种绕来绕去的代码太有意思了，于是我单独把它抽出来做成了一个独立项目。因为十分灵活，所以才叫做“Anysort”。</p> <p>以下展示其灵活、强大的配置功能。就算不懂代码的人也能轻松看懂和配置。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> posts <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'mp3'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token literal-property property">date</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">'2015-01-02'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token literal-property property">comments</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">5</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'mp3'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token literal-property property">date</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">'2015-01-02'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token literal-property property">comments</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">6</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'mp4'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token literal-property property">date</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">'2014-06-01'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token literal-property property">comments</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">7</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'blog'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">'editing'</span><span class="token punctuation">,</span> <span class="token literal-property property">date</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">'2012-01-02'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token literal-property property">comments</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'blog'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">'done'</span><span class="token punctuation">,</span> <span class="token literal-property property">date</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">'2013-05-06'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token literal-property property">comments</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'blog'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">'editing'</span><span class="token punctuation">,</span> <span class="token literal-property property">date</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">'2012-01-02'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token literal-property property">comments</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'blog'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">'editing'</span><span class="token punctuation">,</span> <span class="token literal-property property">date</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">'2014-01-02'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token literal-property property">comments</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'blog'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">'done'</span><span class="token punctuation">,</span> <span class="token literal-property property">date</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">'2014-02-02'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token literal-property property">comments</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">4</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// 选择正在写的博客，根据评论数倒序、时间倒序展示</span>
posts<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>
  <span class="token function">anysort</span><span class="token punctuation">(</span>
    <span class="token string">'tag-has(blog)'</span><span class="token punctuation">,</span>
    <span class="token string">'status-is(editing)'</span><span class="token punctuation">,</span>
    <span class="token string">'comments-len()-dec()'</span><span class="token punctuation">,</span>
    <span class="token string">'date-dec()'</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">)</span>

<span class="token comment">// Results in:</span>
<span class="token comment">//  { &quot;tag&quot;: [&quot;blog&quot;], &quot;status&quot;: &quot;editing&quot;, &quot;date&quot;: &quot;2014-01-02&quot;, &quot;comments&quot;: { &quot;length&quot;: 3 } },</span>
<span class="token comment">//  { &quot;tag&quot;: [&quot;blog&quot;], &quot;status&quot;: &quot;editing&quot;, &quot;date&quot;: &quot;2012-01-02&quot;, &quot;comments&quot;: { &quot;length&quot;: 3 } },</span>
<span class="token comment">//  { &quot;tag&quot;: [&quot;blog&quot;], &quot;status&quot;: &quot;editing&quot;, &quot;date&quot;: &quot;2012-01-02&quot;, &quot;comments&quot;: { &quot;length&quot;: 2 } },</span>
<span class="token comment">//  { &quot;tag&quot;: [&quot;blog&quot;], &quot;status&quot;: &quot;done&quot;, &quot;date&quot;: &quot;2014-02-02&quot;, &quot;comments&quot;: { &quot;length&quot;: 4 } },</span>
<span class="token comment">//  { &quot;tag&quot;: [&quot;blog&quot;], &quot;status&quot;: &quot;done&quot;, &quot;date&quot;: &quot;2013-05-06&quot;, &quot;comments&quot;: { &quot;length&quot;: 1 } },</span>
<span class="token comment">//  { &quot;tag&quot;: [&quot;mp4&quot;], &quot;status&quot;: &quot;&quot;, &quot;date&quot;: &quot;2014-06-01&quot;, &quot;comments&quot;: { &quot;length&quot;: 7 } },</span>
<span class="token comment">//  { &quot;tag&quot;: [&quot;mp3&quot;], &quot;status&quot;: &quot;&quot;, &quot;date&quot;: &quot;2015-01-02&quot;, &quot;comments&quot;: { &quot;length&quot;: 6 } },</span>
<span class="token comment">//  { &quot;tag&quot;: [&quot;mp3&quot;], &quot;status&quot;: &quot;&quot;, &quot;date&quot;: &quot;2015-01-02&quot;, &quot;comments&quot;: { &quot;length&quot;: 5 } },</span>

</code></pre></div><p>最后是完整的源码。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">isVoid</span> <span class="token operator">=</span> <span class="token parameter">x</span> <span class="token operator">=&gt;</span> x <span class="token operator">==</span> <span class="token keyword">undefined</span>
<span class="token keyword">const</span> <span class="token function-variable function">getType</span> <span class="token operator">=</span> <span class="token parameter">x</span> <span class="token operator">=&gt;</span> <span class="token function">isVoid</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">'void'</span> <span class="token operator">:</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">isFn</span> <span class="token operator">=</span> <span class="token parameter">x</span> <span class="token operator">=&gt;</span> <span class="token function">getType</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'function'</span>

<span class="token keyword">const</span> constructor <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">date</span><span class="token operator">:</span> <span class="token parameter">x</span> <span class="token operator">=&gt;</span> <span class="token operator">+</span>x<span class="token punctuation">,</span>
  <span class="token literal-property property">string</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
  <span class="token literal-property property">number</span><span class="token operator">:</span> Number<span class="token punctuation">,</span>
  <span class="token comment">// The priority of true is greater than false</span>
  <span class="token function-variable function">boolean</span><span class="token operator">:</span> <span class="token parameter">x</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>x<span class="token punctuation">,</span>
  <span class="token function-variable function">symbol</span><span class="token operator">:</span> <span class="token parameter">x</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> by <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">default</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> typeA <span class="token operator">=</span> <span class="token function">getType</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
    <span class="token keyword">const</span> typeB <span class="token operator">=</span> <span class="token function">getType</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>typeA <span class="token operator">===</span> <span class="token string">'void'</span> <span class="token operator">||</span> typeB <span class="token operator">===</span> <span class="token string">'void'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> by<span class="token punctuation">.</span><span class="token function">void</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> typeA<span class="token punctuation">,</span> typeB<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> canSort <span class="token operator">=</span> constructor<span class="token punctuation">[</span>typeA<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> typeA <span class="token operator">===</span> typeB
      <span class="token operator">!</span>canSort <span class="token operator">&amp;&amp;</span> console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[TIP] 不能排序对 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>a<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 和 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>b<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 排序，忽略此次比较。你可以传入自定义排序函数对对象进行排序。</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> canSort
        <span class="token operator">?</span> by<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span>typeA<span class="token punctuation">)</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
        <span class="token operator">:</span> <span class="token keyword">undefined</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">type</span><span class="token operator">:</span> <span class="token parameter">type</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> Type <span class="token operator">=</span> <span class="token function">isFn</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token operator">?</span> type <span class="token operator">:</span> constructor<span class="token punctuation">[</span>type<span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Type<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Error occured when compare value </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>a<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> with value </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>b<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> va <span class="token operator">=</span> <span class="token function">Type</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> vb <span class="token operator">=</span> <span class="token function">Type</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
    <span class="token keyword">return</span> va <span class="token operator">===</span> vb <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token punctuation">(</span>va <span class="token operator">&lt;</span> vb <span class="token operator">?</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">void</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> ta<span class="token punctuation">,</span> tb</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ta <span class="token operator">===</span> tb<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>compare <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>pipeline <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token class-name">Sort</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">map</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">_value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>pipeline<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _value<span class="token punctuation">,</span> <span class="token literal-property property">_type</span><span class="token operator">:</span> <span class="token string">'map'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span>
<span class="token punctuation">}</span>
<span class="token class-name">Sort</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">plugin</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">_value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>pipeline<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _value<span class="token punctuation">,</span> <span class="token literal-property property">_type</span><span class="token operator">:</span> <span class="token string">'plugin'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span>
<span class="token punctuation">}</span>
<span class="token class-name">Sort</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sortby</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>compare <span class="token operator">=</span> <span class="token function">isFn</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token operator">?</span> fn <span class="token operator">:</span> by<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span>fn<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">pass</span> <span class="token operator">=</span> <span class="token parameter">sortFn</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">sortFn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span>
<span class="token class-name">Sort</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">seal</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>compare <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>compare <span class="token operator">||</span> by<span class="token punctuation">.</span>default

  <span class="token keyword">const</span> <span class="token function-variable function">plugin</span> <span class="token operator">=</span> <span class="token parameter">plug</span> <span class="token operator">=&gt;</span> <span class="token parameter">sortFn</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">plug</span><span class="token punctuation">(</span><span class="token function">sortFn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token function-variable function">mapping</span> <span class="token operator">=</span> <span class="token parameter">map</span> <span class="token operator">=&gt;</span> <span class="token parameter">sortFn</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">sortFn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> <span class="token function">map</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pipeline<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">lastSortFn<span class="token punctuation">,</span> current</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> _type<span class="token punctuation">,</span> _value <span class="token punctuation">}</span> <span class="token operator">=</span> current
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_type <span class="token operator">===</span> <span class="token string">'map'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">mapping</span><span class="token punctuation">(</span><span class="token function">lastSortFn</span><span class="token punctuation">(</span>_value<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_type <span class="token operator">===</span> <span class="token string">'plugin'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">plugin</span><span class="token punctuation">(</span>_value<span class="token punctuation">)</span><span class="token punctuation">(</span>lastSortFn<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> pass<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>compare<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 加了许多默认插件，挺有意思的~~</span>
<span class="token comment">// 如果有更多好玩的，欢迎 PR~~</span>
<span class="token keyword">const</span> plugins <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">by</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">sort<span class="token punctuation">,</span> args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> sort<span class="token punctuation">.</span><span class="token function">sortby</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function-variable function">asc</span><span class="token operator">:</span> <span class="token parameter">sort</span> <span class="token operator">=&gt;</span> sort<span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span>pass<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function-variable function">dec</span><span class="token operator">:</span> <span class="token parameter">sort</span> <span class="token operator">=&gt;</span> sort<span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token parameter">fn</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">-</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function-variable function">rand</span><span class="token operator">:</span> <span class="token parameter">sort</span> <span class="token operator">=&gt;</span> sort<span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">.5</span> <span class="token operator">?</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">is</span><span class="token operator">:</span> <span class="token punctuation">(</span>sort<span class="token punctuation">,</span> args <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> sort<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x <span class="token operator">===</span> args<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sortby</span><span class="token punctuation">(</span><span class="token string">'boolean'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">all</span><span class="token operator">:</span> <span class="token punctuation">(</span>sort<span class="token punctuation">,</span> args <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> sort<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token parameter">y</span> <span class="token operator">=&gt;</span> y <span class="token operator">===</span> args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sortby</span><span class="token punctuation">(</span><span class="token string">'boolean'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function-variable function">has</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">sort<span class="token punctuation">,</span> args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> sort<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sortby</span><span class="token punctuation">(</span><span class="token string">'boolean'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">not</span><span class="token operator">:</span> <span class="token punctuation">(</span>sort<span class="token punctuation">,</span> args <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> sort<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> args <span class="token operator">?</span> <span class="token punctuation">(</span>x <span class="token operator">!==</span> args<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token operator">!</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sortby</span><span class="token punctuation">(</span><span class="token string">'boolean'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function-variable function">len</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">sort<span class="token punctuation">,</span> args <span class="token operator">=</span> <span class="token keyword">null</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">isVoid</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>
    <span class="token operator">?</span> sort<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sortby</span><span class="token punctuation">(</span><span class="token string">'number'</span><span class="token punctuation">)</span>
    <span class="token operator">:</span> sort<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>length <span class="token operator">===</span> args<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sortby</span><span class="token punctuation">(</span><span class="token string">'boolean'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

  <span class="token function-variable function">default</span><span class="token operator">:</span> <span class="token parameter">name</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> pathsStore <span class="token operator">=</span> name<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token function-variable function">getVal</span> <span class="token operator">=</span> <span class="token parameter">x</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> paths <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>pathsStore<span class="token punctuation">]</span>
      <span class="token keyword">let</span> val <span class="token operator">=</span> x
      <span class="token keyword">while</span> <span class="token punctuation">(</span>val <span class="token operator">&amp;&amp;</span> paths<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        next <span class="token operator">=</span> paths<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        val <span class="token operator">=</span> val<span class="token punctuation">[</span>next<span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> val
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token parameter">sort</span> <span class="token operator">=&gt;</span> sort<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>getVal<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">generate</span><span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> sort <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> <span class="token punctuation">[</span><span class="token operator">...</span>actions<span class="token punctuation">]</span> <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span>
  actions <span class="token operator">=</span> actions<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">action</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">[</span>all<span class="token punctuation">,</span> name<span class="token punctuation">,</span> argsWithQuote<span class="token punctuation">,</span> args<span class="token punctuation">]</span> <span class="token operator">=</span> action<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">([^(]+)(\(([^)]*)\))?</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span>
      <span class="token keyword">const</span> plugin <span class="token operator">=</span> argsWithQuote
        <span class="token operator">?</span> plugins<span class="token punctuation">[</span>name<span class="token punctuation">]</span>
        <span class="token operator">:</span> plugins<span class="token punctuation">.</span><span class="token function">default</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
      <span class="token function">plugin</span><span class="token punctuation">(</span>sort<span class="token punctuation">,</span> args <span class="token operator">||</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> sort<span class="token punctuation">.</span><span class="token function">seal</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>cmd</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  cmd <span class="token operator">=</span> cmd<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">h<span class="token punctuation">,</span> c</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>h<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>cmd<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">undefined</span>

  <span class="token keyword">const</span> sortFns <span class="token operator">=</span> cmd<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">isFn</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">?</span> x <span class="token operator">:</span> <span class="token function">generate</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Error on generate sort function, Index </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">th: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>x<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> <span class="token function-variable function">flat</span> <span class="token operator">=</span> <span class="token parameter">fns</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> fns<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">sortResult<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> sortResult <span class="token operator">||</span> <span class="token function">fn</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token function">flat</span><span class="token punctuation">(</span>sortFns<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> factory
</code></pre></div><h2 id="阅读更多">阅读更多</h2> <p>都看到这儿了，不点个赞，三连一下再走嘛呜呜呜 ┭┮﹏┭┮</p> <p>你可以在这儿找到源码地址和测试文件：<a href="https://github.com/Lionad-Morotar/any-sort" target="_blank" rel="noopener noreferrer">Lionad-Morotar/any-sort</a>，如果有什么好玩儿的想法，欢迎 Fork 及 PR~</p> <p>啊对了，差点忘了文章开头还说到我是在给歌单排序来着。</p> <p>这个是歌单爬虫的地址，大家可以随意参观：<a href="https://github.com/Lionad-Morotar/checheyun" target="_blank" rel="noopener noreferrer">Lionad-Morotar/checheyun</a>，不过项目比较乱，没啥规范，别期待能从里面找到啥有用的东西... 如果大家想给自己的歌单排序又看不懂这玩意儿的话，那就来我的博客留言好了，留下歌单地址和排序方式，我帮你排序，你再把排序好的歌单复制黏贴回去就行儿。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">本文最后更新于:</span> <span class="time">February 24 2023 11:00</span></div></footer> <!----> <div id="page-bottom" data-v-6ec234cc></div></main></div><div class="global-ui"><Comment></Comment></div></div>
    <script src="/assets/js/app.dacd158f.js" defer></script><script src="/assets/js/layout-Layout.a690710d.js" defer></script><script src="/assets/js/vendors~layout-Layout.fb1af457.js" defer></script><script src="/assets/js/linghuoyouyawuyilaidepaixuku.ce1a192e.js" defer></script>
  </body>
</html>
